const $=t=>document.querySelector(t),isValid="<?php echo wp_verify_nonce($nonce, 'wc_store_api'); ?>";let submitCompleteNotice,widgetContainer;const headerRight=document.querySelector(".header-right"),couponInput=$(".woocommerce-cart-form .coupon #coupon_code");let updateCartButton=null,removedGiftId=null,isCartEmpty=!1,cartGiftsIds=null,totalCartGifts=0,quantityInputChanged=!1;function observeNode(t,e){if(!t)return;new MutationObserver((e=>{for(const o of e)if(console.log(o),"attributes"===o.type&&"disabled"===o.attributeName&&t===updateCartButton&&updateCartButton.removeAttribute("disabled"),"childList"===o.type){t===submitCompleteNotice&&(updateCartButton=$("button[name=update_cart]"),updateCartButton.removeAttribute("disabled"),quantityInputChanged=!1,loopCartItems(),checkGiftsSection());const e=t.querySelector(".woocommerce"),o=t.querySelector(".return-to-shop");if(o){e.setAttribute("style","display: flex; flex-direction: column;"),e.querySelector(".wc-empty-cart-message").remove();o.querySelector("a.button.wc-backward").setAttribute("href","https://www.liligrow.es")}}})).observe(t,e)}function checkGiftsSection(){const t=$(".adv-gift-section");if(t){const e=t.querySelectorAll(".owl-stage .owl-item"),o=Array.from(e);for(const t of o){const e=t.querySelector(".wgb-product-item-cnt"),o=t.querySelector(".wgb-add-gift-btn").getAttribute("data-id");cartGiftsIds.has(o)||e.classList.replace("disable-hover","hovering")}unblock(t)}}async function updateItemCart(t){const e=t.getAttribute("value"),o=t.getAttribute("name").match(/\[(.*?)\]/)[1];if(isValid)try{const t=await fetch(`<?php echo esc_url(get_home_url()); ?>/wp-json/wc/store/v1/cart/update-item?key=${o}&quantity=${e}`,{method:"POST",headers:{"Content-Type":"application/json",Nonce:"<?php echo esc_attr($nonce); ?>"}});200===t.status&&t.ok&&(window.location="<?php echo get_permalink(); ?>")}catch(t){console.log(t)}}function block(t){t&&jQuery(t).addClass("loading").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})}function unblock(t){t&&jQuery(t).removeClass("loading").unblock()}function updateQuantity(t,e){const o=$(".adv-gift-section"),c=$(".woocommerce .shop_table.cart"),n=$(".woocommerce .cart-collaterals");block(c),block(n),o&&block(o),t.setAttribute("value",e),quantityInputChanged=!0,updateItemCart(t)}function decrement(t,e){const o=parseInt(e.value);o>1&&!quantityInputChanged&&updateQuantity(e,o-1)}function increment(t,e){const o=parseInt(e.value);quantityInputChanged||updateQuantity(e,o+1)}function checkStock(t,e){const o=t.querySelector('input[type="number"]'),c=parseInt(o.getAttribute("value")),n=parseInt(o.getAttribute("max"));if(Boolean(n)){const o=t.querySelector(".qty-container");let r=o.querySelector(".stock-limit");r&&o.removeChild(r),c===n?(e.setAttribute("disabled","disabled"),e.classList.add("disabled"),r=document.createElement("span"),r.classList.add("stock-limit"),r.textContent='<?php esc_html_e("Stock limit reached", "woocommerce"); ?>',o.appendChild(r)):n>c&&(e.removeAttribute("disabled"),e.classList.remove("disabled"))}}function loopCartItems(){cartGiftsIds=new Set;document.querySelectorAll(".woocommerce-cart-form__cart-item").forEach((t=>{const e=t.querySelector(".qty-container"),o=t.querySelector(".remove");if(t.querySelectorAll(".remove.gift-close-link").forEach((t=>{const e=t.getAttribute("data-id");cartGiftsIds.add(e)})),e){const o=e.querySelector("input[type=number]"),c=t.querySelector("button.decrement"),n=t.querySelector("button.increment");c.addEventListener("click",(()=>{decrement(this,o)})),n.addEventListener("click",(()=>{increment(this,o)})),checkStock(t,n)}o.addEventListener("click",(()=>{if(o.classList.contains("gift-close-link")){const t=$(".adv-gift-section");totalCartGifts=cartGiftsIds.length,removedGiftId=o.getAttribute("data-id"),block(t)}}))}))}couponInput.classList.add("woocommerce-Input","woocommerce-Input--text"),document.addEventListener("DOMContentLoaded",(function(){submitCompleteNotice=$(".woocommerce .woocommerce-notices-wrapper"),widgetContainer=$(".elementor-widget-container"),updateCartButton=$("button[name=update_cart]"),observeNode(updateCartButton,{attributes:!0,attributeFilter:["disabled"]}),observeNode(submitCompleteNotice,{childList:!0}),observeNode(widgetContainer,{childList:!0}),loopCartItems()}));