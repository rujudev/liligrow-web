document.querySelectorAll(".woocommerce-mini-cart-item").forEach((e=>{let t=e.querySelector("button.decrement"),r=e.querySelector("button.increment"),n=e.querySelector("a.remove"),a=e.querySelector(".qty-container"),o=a.querySelector(".qty-result"),c=e.querySelector("input[type=number]"),i=(e.querySelector(".quantity-container"),0),s=0;const l=c.getAttribute("name").match(/\[([^\]]+)\]/g).map((e=>e.slice(1,-1)))[0],u=document.querySelector(".header-right"),d=u.querySelector(".site-header-cart");let m=document.createElement("span");function p(){const e=parseInt(c.getAttribute("value")),t=parseInt(c.getAttribute("max"));Boolean(t)&&(e>=t?(m&&m.remove(),m=document.createElement("span"),m.classList.add("stock-limit"),m.textContent=stockLimitText,a.appendChild(m),r.setAttribute("disabled","disabled"),r.classList.add("disabled")):e<t&&(m&&m.remove(),r.removeAttribute("disabled"),r.classList.remove("disabled")))}async function y(){const e=c.getAttribute("value");if(isValid){const t=await fetch(`https://www.liligrow.es/wp-json/wc/store/v1/cart/update-item?key=${l}&quantity=${e}`,{method:"POST",headers:{"Content-Type":"application/json",Nonce:nonce}});if(200===t.status&&t.ok){jQuery(d).removeClass("loading").unblock();const t=u.querySelector(".mini-cart-contents .count"),r=u.querySelector(".mini-cart-contents .amount-cart bdi"),n=u.querySelector(".top-header-cart #mini-cart-products-qty"),a=u.querySelector(".woocommerce-mini-cart__total.total .woocommerce-Price-amount.amount bdi");let l=c.getAttribute("data-product_price").split(".");l[1]=l[1].slice(0,2);const m=parseFloat(parseFloat(l.join(".")).toFixed(2))*parseInt(e),y=o.querySelector(".qty-price .woocommerce-Price-amount.amount bdi"),b=parseFloat(m).toFixed(2).replace(".",",").split(","),v=`<span class="integer">${b[0]}</span>`,g=`<span class="decimal">${b[1].substring(0,2)}</span>`;y.innerHTML=`${v},${g}€`;const q=Array.from(document.querySelectorAll(".woocommerce-mini-cart-item")).map((e=>e.querySelector(".qty-price .woocommerce-Price-amount.amount bdi").textContent.split("€").join("").replace(",",".")),0);i=q.reduce(((e,t)=>parseFloat(t)+e),0);const S=Array.from(document.querySelectorAll("input[type=number]")).map((e=>e.value));s=S.reduce(((e,t)=>parseInt(t)+e),0);const f=parseFloat(i).toFixed(2).replace(".",",").split(","),A=f[0],h=`<span class="integer">${A}</span>`,w=f[1].substring(0,2),x=`<span class="decimal">${w}</span>`;t.innerText=s,r.innerText=`${A},${w}€`,n.innerText=s,a.innerHTML=`${h},${x}€`,p()}}}t.addEventListener("click",(e=>{e.preventDefault();const t=parseInt(c.getAttribute("value"));t>1&&(jQuery(d).addClass("loading").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),c.setAttribute("value",t-1),c.value=t-1,y())})),r.addEventListener("click",(e=>{e.preventDefault();const t=parseInt(c.getAttribute("value"));jQuery(d).addClass("loading").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),c.setAttribute("value",t+1),c.value=t+1,y()})),n.addEventListener("click",(function(t){t.preventDefault();const r=u.querySelector(".widget_shopping_cart"),n=new MutationObserver((t=>{for(const r of t){r.target;const t=document.querySelector(".mini-cart-contents .count"),a=parseInt(t.innerText),o=document.querySelector(".mini-cart-contents .amount-cart bdi"),i=(parseFloat(o.innerText.split("€")[0].replace(",",".")),e.querySelector(".amount bdi")),s=(parseFloat(i.innerText.split("€")[0].replace(",",".")),u.querySelector(".top-header-cart #mini-cart-products-qty")),l=parseInt(s.innerText),d=parseInt(c.getAttribute("value")),m=u.querySelector(".woocommerce-mini-cart__total.total .woocommerce-Price-amount.amount bdi"),p=(m?.textContent??"0,00€").replace(".",",").split(","),y=`<span class="integer">${p[0]}</span>`,b=`<span class="decimal">${p[1].substring(0,2)}</span>`;t.innerText=a-d,o.innerHTML=`${y},${b}€`,s.innerText=l-d,n.disconnect()}}));n.observe(r,{childList:!0})})),c.addEventListener("keydown",(function(e){const t=e.keyCode,r=parseInt(e.target.value),n=parseInt(this.getAttribute("max"));if(13===t){if(e.preventDefault(),NaN===r)return;jQuery(d).addClass("loading").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),r>n?(this.setAttribute("value",n),this.value=n):(this.setAttribute("value",r),this.value=r),y()}})),p()}));